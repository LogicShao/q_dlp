# MainWindow.py 设置功能使用说明

## 功能概述

我已经为您的 Q_DLP 视频下载器完成了完整的设置功能实现。现在用户可以通过工具栏的"设置"按钮配置各种下载参数和应用选项。

## 新增功能

### 1. 配置管理模块 (utils.py)

新增了以下配置管理功能：
- `load_config()` - 加载配置文件
- `save_config()` - 保存配置文件 
- `get_default_config()` - 获取默认配置
- `get_config_value()` - 获取指定配置值
- `set_config_value()` - 设置指定配置值

配置文件位置：`src/config.json`

### 2. 设置对话框 (SettingsDialog)

完整的设置界面包含4个选项卡：

#### 下载设置
- 默认下载路径选择
- 视频质量选择（best, 1080p, 720p, 480p, worst）
- 音频质量选择（best, 192k, 128k, 96k, worst）
- 视频格式选择（mp4, webm, mkv）
- 音频格式选择（mp3, m4a, wav, aac）
- 字幕下载选项
- 缩略图下载选项

#### 网络设置
- 代理服务器配置
- 连接超时设置（10-300秒）
- 重试次数设置（0-10次）
- 并发下载数设置（1-5个）

#### 界面设置
- 主题选择（light, dark）
- 语言选择（zh_CN, en_US）
- 日志显示选项
- 自动清除日志选项

#### 高级设置
- Cookies文件使用
- 自定义User-Agent
- 默认提取音频选项

### 3. 下载功能增强

修改了 `DownloadThread` 类，现在支持：
- 根据配置选择视频/音频质量
- 使用配置的代理设置
- 应用网络超时设置
- 使用Cookies文件
- 自定义User-Agent
- 根据设置下载字幕和缩略图

## 使用方法

### 打开设置

1. 启动应用程序
2. 点击工具栏右侧的"设置"按钮
3. 在弹出的设置对话框中修改各项参数
4. 点击"确定"保存设置

### 配置说明

#### 视频质量设置
- `best`: 最高可用质量
- `1080p/720p/480p`: 指定分辨率（不超过该分辨率的最佳质量）
- `worst`: 最低质量

#### 音频质量设置
- `best`: 最高可用音质  
- `192k/128k/96k`: 指定比特率
- `worst`: 最低音质

#### 代理设置
格式：`http://host:port`
例如：`http://127.0.0.1:8080`

#### Cookies使用
1. 勾选"使用Cookies"
2. 选择包含cookies的txt文件
3. 用于需要登录才能下载的视频

## 配置文件结构

配置文件自动保存在 `src/config.json`，包含以下结构：

```json
{
    "download": {
        "default_path": "下载路径",
        "video_quality": "视频质量",
        "audio_quality": "音频质量",
        "format": "视频格式",
        "audio_format": "音频格式",
        "subtitle": false,
        "thumbnail": true
    },
    "network": {
        "proxy": "代理地址",
        "timeout": 30,
        "retry_times": 3,
        "concurrent_downloads": 1
    },
    "ui": {
        "theme": "light",
        "language": "zh_CN", 
        "show_log": true,
        "auto_clear_log": true
    },
    "advanced": {
        "use_cookies": false,
        "cookies_file": "",
        "user_agent": "",
        "extract_audio": false
    }
}
```

## 主要改动文件

1. **utils.py** - 新增配置管理功能
2. **MainWindow.py** - 新增SettingsDialog类和相关集成
3. **dlp.py** - 增强下载功能以支持配置参数

## 测试

运行 `test_settings.py` 可以测试配置管理的基本功能。

## 注意事项

- 首次运行会自动创建默认配置文件
- 设置修改后立即生效，无需重启应用
- 配置文件损坏时会自动使用默认配置
- 所有设置都有合理的默认值

现在您的视频下载器已经具备了完整的设置功能！用户可以根据需要灵活配置各种参数。